<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Select CSV Fields - Behavior Chart</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); max-width: 900px; margin: 0 auto; border: 1px solid rgba(255, 255, 255, 0.2); }
        h1 { text-align: center; color: #333; margin-bottom: 10px; font-size: 2.2em; font-weight: 300; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1em; }
        .file-section { background: linear-gradient(135deg, #f8f9ff 0%, #faf5ff 100%); border: 2px solid rgba(102, 126, 234, 0.1); padding: 25px; margin-bottom: 25px; border-radius: 15px; position: relative; overflow: hidden; }
        .file-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .file-section h3 { color: #333; margin-bottom: 20px; font-size: 1.3em; font-weight: 600; display: flex; align-items: center; }
        .file-section h3 i { margin-right: 10px; color: #667eea; }
        .field-group-vertical { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .field-item { display: flex; flex-direction: column; gap: 8px; }
        label { font-weight: 600; color: #555; font-size: 0.9em; display: flex; align-items: center; }
        label i { margin-right: 6px; color: #667eea; }
        select, input[type="text"], input[type="color"] { padding: 12px 15px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 14px; transition: all 0.3s ease; background: white; }
        select:focus, input[type="text"]:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        input[type="color"] { width: 60px; height: 45px; padding: 5px; cursor: pointer; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; margin-top: 20px; transition: all 0.3s ease; }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .back-link { text-align: center; margin-top: 25px; }
        .back-link a { color: #667eea; text-decoration: none; font-weight: 500; transition: color 0.3s ease; display: inline-flex; align-items: center; }
        .back-link a:hover { color: #764ba2; }
        .back-link a i { margin-right: 8px; }
        @media (max-width: 768px) { .field-group-vertical { grid-template-columns: 1fr; } }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-cogs"></i> Configure Your Chart</h1>
        <p class="subtitle">Select the fields and customize your chart appearance</p>
        
        <form onsubmit="generateChart(event)">
            <div class="file-section">
                <h3><i class="fas fa-file-csv"></i> <span id="file1Name">Dataset 1</span></h3>
                <div class="field-group-vertical">
                    <div class="field-item">
                        <label><i class="fas fa-tag"></i> Display Name</label>
                        <input type="text" id="file1_display_name" placeholder="Enter dataset name" required>
                    </div>
                    <div class="field-item">
                        <label><i class="fas fa-palette"></i> Line Color</label>
                        <input type="color" id="color1" value="#0066cc">
                    </div>
                </div>
                <div class="field-group-vertical">
                    <div class="field-item">
                        <label><i class="fas fa-arrows-alt-h"></i> X-axis Field</label>
                        <select id="file1_x_field" required>
                            <option value="">Select X-axis field...</option>
                        </select>
                    </div>
                    <div class="field-item">
                        <label><i class="fas fa-arrows-alt-v"></i> Y-axis Field</label>
                        <select id="file1_y_field" required>
                            <option value="">Select Y-axis field...</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="file-section">
                <h3><i class="fas fa-file-csv"></i> <span id="file2Name">Dataset 2</span></h3>
                <div class="field-group-vertical">
                    <div class="field-item">
                        <label><i class="fas fa-tag"></i> Display Name</label>
                        <input type="text" id="file2_display_name" placeholder="Enter dataset name" required>
                    </div>
                    <div class="field-item">
                        <label><i class="fas fa-palette"></i> Line Color</label>
                        <input type="color" id="color2" value="#00cc66">
                    </div>
                </div>
                <div class="field-group-vertical">
                    <div class="field-item">
                        <label><i class="fas fa-arrows-alt-h"></i> X-axis Field</label>
                        <select id="file2_x_field" required>
                            <option value="">Select X-axis field...</option>
                        </select>
                    </div>
                    <div class="field-item">
                        <label><i class="fas fa-arrows-alt-v"></i> Y-axis Field</label>
                        <select id="file2_y_field" required>
                            <option value="">Select Y-axis field...</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button type="submit">
                <i class="fas fa-chart-line"></i> Generate Chart
            </button>
        </form>
        
        <div class="back-link">
            <a href="/"><i class="fas fa-arrow-left"></i> Upload Different Files</a>
        </div>
    </div>

    <script>
        // Load data from localStorage
        const csvData = JSON.parse(localStorage.getItem('csvData') || '{}');
        
        if (!csvData.file1 || !csvData.file2) {
            alert('No CSV data found. Please upload files again.');
            window.location.href = '/';
        } else {
            // Populate file names
            document.getElementById('file1Name').textContent = csvData.file1.name;
            document.getElementById('file2Name').textContent = csvData.file2.name;
            document.getElementById('file1_display_name').value = csvData.file1.name.replace('.csv', '');
            document.getElementById('file2_display_name').value = csvData.file2.name.replace('.csv', '');
            
            // Populate field options
            function populateSelect(selectId, headers) {
                const select = document.getElementById(selectId);
                headers.forEach(header => {
                    const option = document.createElement('option');
                    option.value = header;
                    option.textContent = header;
                    select.appendChild(option);
                });
            }
            
            populateSelect('file1_x_field', csvData.file1.headers);
            populateSelect('file1_y_field', csvData.file1.headers);
            populateSelect('file2_x_field', csvData.file2.headers);
            populateSelect('file2_y_field', csvData.file2.headers);
        }

        function generateChart(event) {
            event.preventDefault();
            
            const config = {
                file1_x_field: document.getElementById('file1_x_field').value,
                file1_y_field: document.getElementById('file1_y_field').value,
                file2_x_field: document.getElementById('file2_x_field').value,
                file2_y_field: document.getElementById('file2_y_field').value,
                file1_display_name: document.getElementById('file1_display_name').value,
                file2_display_name: document.getElementById('file2_display_name').value,
                color1: document.getElementById('color1').value,
                color2: document.getElementById('color2').value
            };
            
            // Store configuration
            localStorage.setItem('chartConfig', JSON.stringify(config));
            
            // Redirect to chart
            window.location.href = '/chart';
        }
    </script>
</body>
</html>